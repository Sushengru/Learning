#Schema与数据类型优化

这个章节主要讲了如何在数据类型上下功夫来做好数据库的优化。章节里面分了不同的数据类型进行对比说明。<br>
Tips:所有相关的学习只会围绕数据分析师的职业定位来展开，因此“超纲”的内容会直接掉过学习，部分“已知”知识也不会被记录。

## 数据类型

### 整数类型
    1. 整数的数据类型有 TINYINT,SMALLINT,MEDIUMINT,INT,BIGINT。分别使用8,16,24,32,64位存储空间。
        存储的值的数据范围在 -2^(N-1) 到 2^(N-1)-1之间。例如TINYINT，存储范围为-128~127。
    
    2. UNSIGINED属性表示不允许负值，带上该关键字字段没有负数存储空间，因此使得正数的存储空间翻倍。
    
    3. 对于数据类型的选择影响的是数据的存储空间，而数据的计算仍然使用64位的BIGINT正数。（这句不知如何理解）
    
    4. MySQL可以指定数据类型的宽度，如INT(11)。而实际对于数据类型的存储范围并没有影响，该宽度仅影响
        交互工具显示字符的个数。
        


### 实数类型
    1. MySQL拥有 decimal、float、double 3种数据类型可以存储带有小数的数据。decimal用于存储精确实数，
        float和double存储不精确实数。
        
    2. decimal可以指定小数点前后的数据位数。
    
    3. 每4个字节存储9个数字，小数点占用4个字节。例如，decimal(18,9)占用了12个字节。float使用4个字节
        存储，double使用8个字节。因此，浮点型数据在存储时，比decimal占用更少的存储空间。
        
    4. 浮点型数据实际计算时，和整数一样，均使用最大范围(double)进行计算。
        
    5. 因为decimal需要占用额外的空间和计算开销，所以尽量在仅需要对小数进行精确计算时才使用decimal。例如，存
        储财务数据。而在数据量比较大的情况下，可以使用BIGINT代替decimal，将小数点前后数据分别用整数方式存储。
        
    
### VARCHAR和CHAR
    1. VARCHAR需要额外使用1~2个字节用于记录数据长度：如果列的最大长度<=255个字节，则使用1个字节，否则使用2个
        字节。即，VARCHAR(10)的列需要11个字节的存储空间，VARCHAR(1000)需要1002个字节。
       
    2. 因VARCHAR用于存储可变长字符串，一定程度上节省了存储空间，因此相比CHAR，对性能提升会有一定帮助。因此，
        VARCHAR非常适合用于存储字符串列的极值比均值大很多、且更新频率低的数据列。
            
    3. CHAR是定长的，更适合存储长度短、或者所有值都接近同一个长度的数据列。
    
    4. 用VARCHAR(5)和VARCHAR(200)存储‘hello’的空间开销是一致的，但VARCHAR(200)会消耗更多的内存。因为MySQL
        通常会分配大小的内存块来保存内部值。因此最好的策略是只分配真正需要的空间。
        
        
###BOLB和TEXT
    1. 两者都是用于存储很大的字符串数据，但分别采用了二进制和字符方式进行存储。
    
    2. 当值太大时，MySQL会使用“外部”存储区域来帮助存储，此时每个值在行内需要1~4个字节存储一个指针，然后在外部
        存储区域存储实际值。
        
    3. MySQL对于两者的排序与其他数据类型不同：它只对每列的最前max_sort_length做排序。
        [注： order by sustring(columns, length)可对前n个长度字符进行排序]
    

###使用枚举(ENUM)代替字符串类型
    1. 枚举列可以把一些不重复的字符串存储成一个预定义的集合，且MySQL在存储ENUM时会非常紧凑，根据列表值的数量甚
        至压缩到1或2个字节中。因此ENUM较字符串消耗的存储空间会更小。
        
    2. 枚举的缺点在于，添加/删除新的枚举元素需要通过ALTER TABLE来实现。因此对于未来会有元素改变的列来说，ENUM
        不一定实用。
        

###日期和时间类型
    1. datetime的存储与时区无关，TIMESTAMP的显示值依赖于时区，即会考虑当前时区情况显示实际时间。
    
    2. datetime使用8个字节的存储空间，TIMESTAMP使用4个字节。因此，除特殊行为之外，可尽量使用TIMESTAMP进行存
        储时间，因为它的空间消耗更低。
    
## 其他
###缓存表和汇总表
        这里就不再列点去阐述知识点了，该部分讲的更多的是关于实际应用中，通过建立缓存表或汇总表来替代仅用一张大表
    或重复执行相同查询的操作。（包括视图功能也是如此。）    
        缓存表可以用于存储原表中查询比较频繁的数据片段，例如近一年的数据。汇总表而是汇总groupby等查询操作的结果
    形成的表，能够有效减少常规groupby查询引起的资源消耗。
        
        